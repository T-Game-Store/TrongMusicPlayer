<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Tr·ªçng Music Player</title>
  <style>
    :root {
      --neon-blue: #0ff;
      --neon-purple: #f0f;
      --neon-songtitle: #8a2be2;
      --bg-dark-start: #0a081d;
      --bg-dark-mid: #1d1b40;
      --bg-dark-end: #17172b;
      --control-btn-color: #0ff;
      --lyrics-bg: rgba(0, 0, 0, 0.4);
      --lyrics-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
      --countdown-color: #ff0;
      --text-glow-strength: 0 0 10px, 0 0 20px, 0 0 30px;
      --visualizer-color: #00ffff;
      --dark-pulse-color-1: #360036;
      --dark-pulse-color-2: #00004d;
      --dark-pulse-color-3: #1a001a;

      --disc-center-color: #0d0a26;
      --disc-border-inner: #0088cc;
      --disc-border-outer: #880088;
      --disc-shadow: 0 0 30px rgba(0, 255, 255, 0.8), 0 0 60px rgba(255, 0, 255, 0.6);
      --disc-text-color: #c9c9ff;

      --modal-bg: rgba(0, 0, 0, 0.7);
      --modal-border: 2px solid var(--neon-blue);
      --modal-glow: 0 0 25px rgba(0, 255, 255, 0.7);
      --input-bg: rgba(255, 255, 255, 0.1);
      --input-border: 1px solid var(--neon-purple);
      --input-focus-shadow: 0 0 10px var(--neon-purple);
      --playlist-add-btn: #28a745;
      --playlist-add-btn-hover: #218838;
      --playlist-add-btn-shadow: 0 0 15px rgba(40, 167, 69, 0.7);

      --confirm-btn-ok: #28a745;
      --confirm-btn-cancel: #dc3545;
    }

    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: radial-gradient(circle, var(--bg-dark-start), var(--bg-dark-mid), var(--bg-dark-end));
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 40px 20px;
      overflow-x: hidden;
      position: relative;
    }

    #visualizer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      opacity: 0.3;
      pointer-events: none;
    }

    h1,
    #songTitle,
    .file-inputs,
    #lyrics,
    .controls,
    .speed-controls,
    #albumArt,
    .seek-bar-container {
      position: relative;
      z-index: 10;
    }

    h1 {
      font-size: 3.5rem;
      margin-bottom: 10px;
      background: linear-gradient(to right, var(--neon-purple), var(--neon-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: var(--text-glow-strength) rgba(255, 255, 255, 0.9);
      letter-spacing: 3px;
    }

    #songTitle {
      font-size: 2.2rem;
      color: var(--neon-songtitle);
      text-shadow: 0 0 15px var(--neon-songtitle), 0 0 25px rgba(138, 43, 226, 0.7);
      margin-bottom: 30px;
      text-align: center;
      min-height: 2.5rem;
      font-weight: 700;
    }

    input[type="file"] {
      display: none;
    }

    .file-input-label {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.15), rgba(255, 0, 255, 0.15));
      border: 2px solid var(--neon-blue);
      position: relative;
      overflow: hidden;
      color: var(--neon-blue);
      padding: 14px 30px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      box-shadow: 0 0 20px var(--neon-blue), inset 0 0 8px rgba(0, 255, 255, 0.6);
      margin: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .file-input-label:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .file-input-label:hover:before {
      left: 100%;
    }

    .file-input-label:hover {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.25), rgba(255, 0, 255, 0.25));
      color: var(--neon-purple);
      box-shadow: 0 0 30px var(--neon-purple), inset 0 0 10px rgba(255, 0, 255, 0.8);
      transform: translateY(-4px) scale(1.03);
    }

    .file-input-label:active {
      transform: translateY(2px);
      box-shadow: 0 0 15px var(--neon-blue);
    }

    audio {
      display: none;
    }

    #lyrics {
      margin-top: 30px;
      width: 90%;
      max-width: 700px;
      height: 250px;
      overflow-y: auto;
      text-align: center;
      font-size: 1.4rem;
      line-height: 1.8;
      background: var(--lyrics-bg);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--lyrics-shadow);
      border: 1px solid rgba(0, 255, 255, 0.3);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      position: relative;
      z-index: 1;
      opacity: 0;
      transform: translateY(30px) scale(0.95);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      pointer-events: none;
      flex-shrink: 0;
    }

    #lyrics.show {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    #lyrics::-webkit-scrollbar {
      width: 10px;
    }

    #lyrics::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 10px;
    }

    #lyrics::-webkit-scrollbar-thumb {
      background: var(--neon-blue);
      border-radius: 10px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 12px var(--neon-blue);
    }

    #lyrics::-webkit-scrollbar-thumb:hover {
      background: var(--neon-purple);
      box-shadow: 0 0 16px var(--neon-purple);
    }

    #lyrics div {
      transition: all 0.4s ease-out, transform 0.2s ease-out;
      padding: 2px 0;
      color: rgba(255, 255, 255, 0.7);
    }

    .highlight {
      color: var(--neon-blue);
      font-weight: bold;
      text-shadow: var(--text-glow-strength) var(--neon-blue);
      transform: scale(1.07);
    }

    #albumArt {
      margin-top: 30px;
      width: 250px;
      height: 250px;
      border-radius: 50%;
      background: radial-gradient(circle at center,
          var(--disc-center-color) 0%,
          #1a0f3d 10%,
          var(--disc-border-inner) 40%,
          var(--disc-border-outer) 70%,
          #000000 100%);
      box-shadow: var(--disc-shadow);
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px) scale(0.95);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      pointer-events: none;
      flex-shrink: 0;
    }

    #albumArt.show {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    #albumArt.playing {
      animation: rotateDisc 15s linear infinite;
    }

    #albumArt::before {
      content: '';
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #050510;
      border: 5px solid rgba(0, 255, 255, 0.7);
      box-shadow: 0 0 15px var(--neon-blue);
      z-index: 2;
    }

    #songTitleOnDisc {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      color: var(--disc-text-color);
      font-size: 1.2rem;
      font-weight: bold;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
      white-space: nowrap;
      overflow: hidden;
      pointer-events: none;
    }

    .song-title-char {
      position: absolute;
      transform-origin: center bottom;
      color: var(--disc-text-color);
      text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-purple), 0 0 15px rgba(255, 255, 255, 0.5);
      font-size: 0.9em;
      font-weight: 700;
      letter-spacing: 0.1em;
    }

    @keyframes rotateDisc {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .controls {
      margin-top: 40px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .controls.show {
      opacity: 1;
    }

    .controls button {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.15), rgba(255, 0, 255, 0.15));
      border: 2px solid var(--neon-blue);
      position: relative;
      overflow: hidden;
      color: var(--neon-blue);
      padding: 15px 30px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 0 20px var(--neon-blue), inset 0 0 8px rgba(0, 255, 255, 0.6);
    }

    .controls button:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .controls button:hover:before {
      left: 100%;
    }

    .controls button:hover {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.25), rgba(255, 0, 255, 0.25));
      color: var(--neon-purple);
      box-shadow: 0 0 30px var(--neon-purple), inset 0 0 10px rgba(255, 0, 255, 0.8);
      transform: translateY(-4px) scale(1.03);
    }

    .controls button:active {
      transform: translateY(2px);
      box-shadow: 0 0 15px var(--neon-blue);
    }

    .speed-controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .speed-controls.show {
      opacity: 1;
    }

    .speed-controls button {
      background: none;
      border: 2px solid var(--neon-purple);
      color: var(--neon-purple);
      padding: 8px 15px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      text-shadow: 0 0 10px var(--neon-purple);
      box-shadow: 0 0 10px var(--neon-purple);
    }

    .speed-controls button.active,
    .speed-controls button:hover {
      background-color: rgba(255, 0, 255, 0.25);
      box-shadow: 0 0 20px var(--neon-purple), inset 0 0 8px rgba(255, 0, 255, 0.7);
    }

    #countdown-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12rem;
      font-weight: bold;
      color: var(--countdown-color);
      text-shadow: 0 0 50px var(--countdown-color), 0 0 100px var(--countdown-color), 0 0 150px rgba(255, 255, 0, 0.7);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      z-index: 9999;
    }

    #countdown-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    #countdown-number {
      animation: countdownPop 1s ease-out forwards;
      display: block;
    }

    .seek-bar-container {
      margin-top: 30px;
      width: 90%;
      max-width: 700px;
      position: relative;
      z-index: 10;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .seek-bar-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    #seekBar {
      width: 100%;
      -webkit-appearance: none;
      height: 12px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 10px;
      outline: none;
      transition: all 0.2s ease;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
    }

    #seekBar::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--neon-blue);
      cursor: grab;
      box-shadow: 0 0 20px var(--neon-blue), 0 0 30px var(--neon-purple);
      transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
    }

    #seekBar::-moz-range-thumb {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--neon-blue);
      cursor: grab;
      box-shadow: 0 0 20px var(--neon-blue), 0 0 30px var(--neon-purple);
      transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
    }

    #seekBar:hover::-webkit-slider-thumb,
    #seekBar:active::-webkit-slider-thumb {
      background: var(--neon-purple);
      box-shadow: 0 0 25px var(--neon-purple), 0 0 40px var(--neon-blue);
      transform: scale(1.1);
      cursor: grabbing;
    }

    #seekBar:hover::-moz-range-thumb,
    #seekBar:active::-moz-range-thumb {
      background: var(--neon-purple);
      box-shadow: 0 0 25px var(--neon-purple), 0 0 40px var(--neon-blue);
      transform: scale(1.1);
      cursor: grabbing;
    }

    #seekBar::-webkit-slider-runnable-track {
      background: linear-gradient(to right,
          var(--neon-blue) 0%,
          var(--neon-purple) 100%);
      border-radius: 10px;
      height: 12px;
      box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.2);
    }

    #seekBar::-moz-range-track {
      background: linear-gradient(to right,
          var(--neon-blue) 0%,
          var(--neon-purple) 100%);
      border-radius: 10px;
      height: 12px;
      box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.2);
    }

    .time-display {
      font-size: 1.1rem;
      color: var(--neon-blue);
      text-shadow: 0 0 10px var(--neon-blue);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .time-display span {
      transition: color 0.3s ease;
    }

    .time-display #currentTime {
      color: var(--neon-purple);
      text-shadow: 0 0 12px var(--neon-purple);
    }

    @keyframes countdownPop {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }

      50% {
        transform: scale(1.3);
        opacity: 1;
      }

      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    #playlist-management-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      z-index: 100;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    #playlists-area {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    #playlist-controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    #playlist-controls button {
      background: linear-gradient(45deg, rgba(0, 150, 200, 0.15), rgba(150, 0, 200, 0.15));
      border: 2px solid var(--neon-blue);
      color: var(--neon-blue);
      padding: 10px 20px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
    }

    #playlist-controls button:hover {
      background: linear-gradient(45deg, rgba(0, 150, 200, 0.25), rgba(150, 0, 200, 0.25));
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
      transform: translateY(-2px);
    }

    #playlists-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 250px;
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 10px;
      border: 1px solid rgba(0, 255, 255, 0.2);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    }

    #playlists-list::-webkit-scrollbar {
      width: 8px;
    }

    #playlists-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    #playlists-list::-webkit-scrollbar-thumb {
      background: var(--neon-blue);
      border-radius: 8px;
      box-shadow: 0 0 8px var(--neon-blue);
    }


    .playlist-item {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--neon-purple);
      color: var(--neon-purple);
      padding: 8px 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px var(--neon-purple);
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      box-sizing: border-box;
    }

    .playlist-item:hover {
      background: rgba(0, 0, 0, 0.7);
      box-shadow: 0 0 15px var(--neon-purple);
      transform: translateY(-2px);
    }

    .playlist-item.active {
      background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
      color: white;
      box-shadow: 0 0 20px var(--neon-blue), 0 0 25px var(--neon-purple);
    }

    .playlist-item button {
      background: none;
      border: none;
      color: white;
      font-size: 1.1rem;
      cursor: pointer;
      margin-left: 5px;
      transition: transform 0.2s ease;
      padding: 0 5px;
    }

    .playlist-item button:hover {
      transform: scale(1.2);
      color: red;
    }

    #current-playlist {
      background: var(--lyrics-bg);
      border-radius: 20px;
      padding: 20px;
      box-shadow: var(--lyrics-shadow);
      border: 1px solid rgba(0, 255, 255, 0.3);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      min-height: 100px;
      max-height: 400px;
      overflow-y: auto;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      width: 400px;
      position: absolute;
      left: 290px;
      top: 0;
      pointer-events: none;
    }

    #current-playlist.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    #current-playlist h2 {
      text-align: center;
      color: var(--neon-blue);
      text-shadow: 0 0 10px var(--neon-blue);
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    #playlist-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    #playlist-actions button {
      background: var(--playlist-add-btn);
      border: 2px solid var(--playlist-add-btn);
      color: white;
      padding: 8px 15px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: var(--playlist-add-btn-shadow);
    }

    #playlist-actions button:hover {
      background: var(--playlist-add-btn-hover);
      box-shadow: 0 0 20px rgba(40, 167, 69, 1);
      transform: translateY(-2px);
    }


    #playlist-songs {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #playlist-songs li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.1rem;
      cursor: pointer;
      transition: background-color 0.2s ease, color 0.2s ease;
    }

    #playlist-songs li:last-child {
      border-bottom: none;
    }

    #playlist-songs li:hover {
      background-color: rgba(0, 255, 255, 0.1);
      color: var(--neon-blue);
    }

    #playlist-songs li.playing {
      background-color: rgba(255, 0, 255, 0.2);
      color: var(--neon-purple);
      font-weight: bold;
      box-shadow: inset 0 0 10px rgba(255, 0, 255, 0.5);
    }

    #playlist-songs li span {
      flex-grow: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #playlist-songs li .remove-song-btn {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      font-size: 1rem;
      cursor: pointer;
      margin-left: 10px;
      transition: color 0.2s ease, transform 0.2s ease;
    }

    #playlist-songs li .remove-song-btn:hover {
      color: red;
      transform: scale(1.1);
    }

    #playlist-playback-modes {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    #playlist-playback-modes button {
      background: none;
      border: 2px solid var(--neon-blue);
      color: var(--neon-blue);
      padding: 8px 15px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      text-shadow: 0 0 10px var(--neon-blue);
      box-shadow: 0 0 10px var(--neon-blue);
    }

    #playlist-playback-modes button.active {
      background-color: rgba(0, 255, 255, 0.25);
      box-shadow: 0 0 20px var(--neon-blue), inset 0 0 8px rgba(0, 255, 255, 0.7);
    }

    #playlist-playback-modes button:hover {
      background-color: rgba(0, 255, 255, 0.25);
      box-shadow: 0 0 20px var(--neon-blue), inset 0 0 8px rgba(0, 255, 255, 0.7);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: var(--modal-bg);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }

    .modal.show {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(29, 27, 64, 0.9), rgba(17, 17, 43, 0.9));
      margin: auto;
      padding: 40px;
      border: var(--modal-border);
      border-radius: 25px;
      width: 80%;
      max-width: 450px;
      box-shadow: var(--modal-glow);
      text-align: center;
      transform: scale(0.9);
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    .modal.show .modal-content {
      transform: scale(1);
    }

    .modal-content h3 {
      color: var(--neon-blue);
      font-size: 2rem;
      margin-bottom: 25px;
      text-shadow: var(--text-glow-strength) var(--neon-blue);
    }

    .modal-content input[type="text"] {
      width: calc(100% - 40px);
      padding: 15px;
      margin-bottom: 25px;
      border: var(--input-border);
      background-color: var(--input-bg);
      color: white;
      border-radius: 10px;
      font-size: 1.1rem;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    .modal-content input[type="text"]::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .modal-content input[type="text"]:focus {
      border-color: var(--neon-purple);
      box-shadow: var(--input-focus-shadow);
    }

    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .modal-buttons button {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.15), rgba(255, 0, 255, 0.15));
      border: 2px solid var(--neon-blue);
      color: var(--neon-blue);
      padding: 12px 25px;
      border-radius: 40px;
      cursor: pointer;
      font-size: 1.05rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px var(--neon-blue);
    }

    .modal-buttons button:hover {
      background: linear-gradient(45deg, rgba(0, 255, 255, 0.25), rgba(255, 0, 255, 0.25));
      color: var(--neon-purple);
      box-shadow: 0 0 25px var(--neon-purple);
      transform: translateY(-2px);
    }

    #confirmModal .modal-content h3 {
      font-size: 1.5rem;
      color: var(--neon-purple);
    }

    #confirmModal .modal-content p {
      margin-bottom: 25px;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
    }

    #confirmModal .modal-buttons button.confirm-ok {
      background-color: var(--confirm-btn-ok);
      border-color: var(--confirm-btn-ok);
      box-shadow: 0 0 15px var(--confirm-btn-ok);
      color: white;
    }

    #confirmModal .modal-buttons button.confirm-ok:hover {
      background-color: var(--playlist-add-btn-hover);
      box-shadow: 0 0 25px var(--confirm-btn-ok);
    }

    #confirmModal .modal-buttons button.confirm-cancel {
      background-color: var(--confirm-btn-cancel);
      border-color: var(--confirm-btn-cancel);
      box-shadow: 0 0 15px var(--confirm-btn-cancel);
      color: white;
    }

    #confirmModal .modal-buttons button.confirm-cancel:hover {
      background-color: #c82333;
      box-shadow: 0 0 25px var(--confirm-btn-cancel);
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <canvas id="visualizer"></canvas>

  <div id="playlist-management-container">
    <div id="playlists-area">
      <div id="playlist-controls">
        <button onclick="showCreatePlaylistModal()">+ T·∫°o danh s√°ch m·ªõi</button>
      </div>
      <div id="playlists-list">
      </div>
    </div>
    <div id="current-playlist">
      <h2 id="current-playlist-title"></h2>
      <div id="playlist-actions">
        <button onclick="triggerAddSongToFileInput()">
          <span class="icon">‚ûï</span> Th√™m nh·∫°c v√†o DS
        </button>
      </div>
     
      <ul id="playlist-songs">
      </ul>
    </div>
  </div>

  <h1>üéß Tr·ªçng Music Player</h1>
  <div id="songTitle"></div>

  <div class="file-inputs">
    <label for="audioFile" class="file-input-label">
      <span class="icon">üéµ</span> Ch·ªçn nh·∫°c MP3 (Ch∆°i ƒë∆°n)
    </label>
    <input type="file" id="audioFile" accept="audio/*, .mp3, .m4a, .wav" />

    <label for="lrcFile" class="file-input-label">
      <span class="icon">üìù</span> Ch·ªçn Lyrics .LRC
    </label>
    <input type="file" id="lrcFile" accept=".lrc,.txt" />
  </div>

  <audio id="audio"></audio>

  <div id="lyrics">Upload .lrc to see synchronized lyrics here</div>
  <div id="albumArt">
    <div id="songTitleOnDisc"></div>
  </div>


  <div class="seek-bar-container">
    <input type="range" id="seekBar" value="0" min="0" max="0" step="0.01" />
    <div class="time-display">
      <span id="currentTime">00:00</span> / <span id="duration">00:00</span>
    </div>
  </div>

  <div class="controls">
    <button onclick="rewindAudio()">‚è™ -10s</button>
    <button onclick="playAudio()">‚ñ∂ Play</button>
    <button onclick="pauseAudio()">‚è∏ Pause</button>
    <button onclick="forwardAudio()">‚è© +10s</button>
  </div>

  <div class="speed-controls">
    <button onclick="setPlaybackSpeed(0.5)">0.5x</button>
    <button onclick="setPlaybackSpeed(1)" class="active">1x</button>
    <button onclick="setPlaybackSpeed(1.5)">1.5x</button>
    <button onclick="setPlaybackSpeed(2)">2x</button>
  </div>

  <div id="countdown-overlay">
    <span id="countdown-number"></span>
  </div>

  <div id="createPlaylistModal" class="modal">
    <div class="modal-content">
      <h3>T·∫°o Danh S√°ch Ph√°t M·ªõi</h3>
      <input type="text" id="newPlaylistNameInput" placeholder="Nh·∫≠p t√™n danh s√°ch ph√°t..." />
      <div class="modal-buttons">
        <button onclick="createNewPlaylist()">T·∫°o</button>
        <button onclick="hideCreatePlaylistModal()">H·ªßy</button>
      </div>
    </div>
  </div>

  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3 id="confirmModalTitle">X√°c nh·∫≠n</h3>
      <p id="confirmModalMessage"></p>
      <div class="modal-buttons">
        <button class="confirm-ok" id="confirmOkButton">ƒê·ªìng √Ω</button>
        <button class="confirm-cancel" id="confirmCancelButton">H·ªßy</button>
      </div>
    </div>
  </div>

 <script>
    const seekBar = document.getElementById("seekBar");
    const currentTimeSpan = document.getElementById("currentTime");
    const durationSpan = document.getElementById("duration");
    const seekBarContainer = document.querySelector(".seek-bar-container");
    const audio = document.getElementById("audio");
    const audioFile = document.getElementById("audioFile");
    const lrcFile = document.getElementById("lrcFile");
    const lyricsDiv = document.getElementById("lyrics");
    const albumArtDiv = document.getElementById("albumArt");
    const songTitleOnDiscDiv = document = document.getElementById("songTitleOnDisc");
    const songTitleDiv = document.getElementById("songTitle");
    const controlsDiv = document.querySelector(".controls");
    const speedControlsDiv = document.querySelector(".speed-controls");
    const countdownOverlay = document.getElementById("countdown-overlay");
    const countdownNumber = document.getElementById("countdown-number");
    const speedButtons = document.querySelectorAll(".speed-controls button");

    const playlistsList = document.getElementById('playlists-list');
    const currentPlaylistDiv = document.getElementById('current-playlist');
    const currentPlaylistTitle = document.getElementById('current-playlist-title');
    const playlistSongsUl = document.getElementById('playlist-songs');

    const createPlaylistModal = document.getElementById('createPlaylistModal');
    const newPlaylistNameInput = document.getElementById('newPlaylistNameInput');

    const confirmModal = document.getElementById('confirmModal');
    const confirmModalTitle = document.getElementById('confirmModalTitle');
    const confirmModalMessage = document.getElementById('confirmModalMessage');
    const confirmOkButton = document.getElementById('confirmOkButton');
    const confirmCancelButton = document.getElementById('confirmCancelButton');


    let lyrics = [];
    let currentLine = -1;
    let audioLoaded = false;
    let lrcLoaded = false;
    let isCountingDown = false;

    let playlists = {}; 
    let activePlaylistName = null; 
    let currentPlaylistSongs = [];
    let currentSongIndex = -1;
    let playbackMode = 'normal'; 
    let shuffledIndexes = [];


    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');
    let audioContext;
    let analyser;
    let dataArray;
    let bufferLength;
    let currentAverageFrequency = 0;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    function setupVisualizer() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaElementSource(audio);
        analyser = audioContext.createAnalyser();
        source.connect(analyser);
        analyser.connect(audioContext.destination);
        analyser.fftSize = 256;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
      }
      drawVisualizer();
    }

    function drawVisualizer() {
      requestAnimationFrame(drawVisualizer);

      if (!analyser || audio.paused) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        currentAverageFrequency = 0;
        return;
      }

      analyser.getByteFrequencyData(dataArray);

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let sum = 0;
      for (let i = 0; i < bufferLength; i++) {
        sum += dataArray[i];
      }
      let average = sum / bufferLength;

      currentAverageFrequency =
        currentAverageFrequency * 0.9 + average * 0.1;

      const pulseStrength = currentAverageFrequency / 255;
      const maxGlow = 100;
      const glow = maxGlow * pulseStrength * pulseStrength;

      const gradientBg = ctx.createRadialGradient(
        canvas.width / 2,
        canvas.height / 2,
        0,
        canvas.width / 2,
        canvas.height / 2,
        canvas.width > canvas.height ? canvas.width / 1.5 : canvas.height / 1.5
      );

      gradientBg.addColorStop(0, `rgba(
        ${Math.round(40 + glow * 0.5)},
        ${Math.round(0 + glow * 0.2)},
        ${Math.round(40 + glow * 0.5)},
        ${0.1 + pulseStrength * 0.3}
    )`);
      gradientBg.addColorStop(1, `rgba(
        ${Math.round(0 + glow * 0.1)},
        ${Math.round(0 + glow * 0.1)},
        ${Math.round(20 + glow * 0.1)},
        0
    )`);
      ctx.fillStyle = gradientBg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const barWidth = (canvas.width / bufferLength) * 2.5;
      let x = 0;

      for (let i = 0; i < bufferLength; i++) {
        const barHeight = dataArray[i] * 1.5;

        const barGradient = ctx.createLinearGradient(
          0,
          canvas.height - barHeight,
          0,
          canvas.height
        );
        barGradient.addColorStop(
          0,
          `rgba(
            ${Math.round(0 + dataArray[i])},
            ${Math.round(255 - dataArray[i])},
            ${Math.round(255)},
            ${0.5 + dataArray[i] / 510}
        )`
        );
        barGradient.addColorStop(
          1,
          `rgba(
            ${Math.round(dataArray[i] / 2)},
            ${Math.round(0)},
            ${Math.round(dataArray[i] / 2)},
            ${0.1 + dataArray[i] / 765}
        )`
        );

        ctx.fillStyle = barGradient;
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

        x += barWidth + 2;
      }
    }


    function checkAndShowControls() {
      if (audioLoaded || (activePlaylistName && currentPlaylistSongs.length > 0 && currentSongIndex !== -1)) {
        controlsDiv.classList.add("show");
        speedControlsDiv.classList.add("show");
        seekBarContainer.classList.add("show");
      } else {
        controlsDiv.classList.remove("show");
        speedControlsDiv.classList.remove("show");
        seekBarContainer.classList.remove("show");
        lyricsDiv.classList.remove("show");
        albumArtDiv.classList.remove("show");
      }
    }

    function displaySongTitleOnDisc(title) {
      songTitleOnDiscDiv.innerHTML = '';
      const displayTitle = title.length > 30 ? title.substring(0, 30) + '...' : title;

      const radius = albumArtDiv.offsetWidth / 2 - 20;
      const totalAngle = Math.PI * 1.6;
      const startAngle = (Math.PI * 2 - totalAngle) / 2;

      const angIncrement = totalAngle / displayTitle.length;

      for (let i = 0; i < displayTitle.length; i++) {
        const char = displayTitle[i];
        const span = document.createElement('span');
        span.classList.add('song-title-char');
        span.textContent = char;

        const angle = startAngle + angIncrement * i;
        const x = radius * Math.cos(angle - Math.PI / 2);
        const y = radius * Math.sin(angle - Math.PI / 2);

        span.style.left = `calc(50% + ${x}px)`;
        span.style.top = `calc(50% + ${y}px)`;
        span.style.transform = `translate(-50%, -50%) rotate(${angle * (180 / Math.PI) + 90}deg)`;
        songTitleOnDiscDiv.appendChild(span);
      }
    }


    audioFile.addEventListener("change", async function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        audio.src = url;
        audioLoaded = true;
        const fileName = file.name.split('.').slice(0, -1).join('.');
        songTitleDiv.textContent = fileName;
        displaySongTitleOnDisc(fileName);


        lyricsDiv.innerHTML = 'Upload .lrc to see synchronized lyrics here';
        lyrics = [];
        currentLine = -1;
        lrcLoaded = false;
        currentAverageFrequency = 0;
        setupVisualizer();
        checkAndShowControls();

        activePlaylistName = null;
        currentPlaylistDiv.classList.remove('show');
        renderPlaylists(); 
        updateCurrentPlaylistDisplay(); 
        playAudio(); 
      }
    });

    const addSongFileInput = document.createElement('input');
    addSongFileInput.type = 'file';
    addSongFileInput.accept = 'audio/*, .mp3, .m4a, .wav';
    addSongFileInput.multiple = true;
    addSongFileInput.style.display = 'none';
    document.body.appendChild(addSongFileInput);

    addSongFileInput.addEventListener("change", async function () {
      if (!activePlaylistName) {
        alert("Vui l√≤ng ch·ªçn ho·∫∑c t·∫°o m·ªôt danh s√°ch ph√°t tr∆∞·ªõc khi th√™m nh·∫°c!");
        return;
      }

      const files = this.files;
      if (files.length > 0) {
        for (const file of files) {
          const url = URL.createObjectURL(file);
          const fileName = file.name.split('.').slice(0, -1).join('.');
          addSongToPlaylist(fileName, url);
        }
      }
      this.value = '';
    });

    function triggerAddSongToFileInput() {
      addSongFileInput.click();
    }


    lrcFile.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          parseLRC(e.target.result);
          lrcLoaded = true;
          albumArtDiv.classList.remove("show");
          albumArtDiv.classList.remove("playing");
          lyricsDiv.classList.add("show");
          if (audioLoaded) {
            displayLyricsContent();
          }
        };
        reader.readAsText(file);
      }
    });

    function parseLRC(text) {
      lyrics = [];
      const lines = text.split("\n");
      for (const line of lines) {
        const match = line.match(/\[(\d{2}):(\d{2}(?:\.\d{1,3})?)\](.*)/);
        if (match) {
          const min = parseInt(match[1]);
          const sec = parseFloat(match[2]);
          const time = min * 60 + sec;
          lyrics.push({
            time,
            text: match[3].trim()
          });
        }
      }
      lyrics.sort((a, b) => a.time - b.time);
    }

    function displayLyricsContent() {
      if (lyrics.length === 0) {
        lyricsDiv.innerHTML = "No lyrics loaded or parsed.";
        return;
      }
      lyricsDiv.innerHTML = lyrics
        .map((line) => `<div>${line.text || '&nbsp;'}</div>`)
        .join("");
    }

    audio.addEventListener("timeupdate", function () {
      if (!seekBar.changing) {
        seekBar.value = audio.currentTime;
      }
      currentTimeSpan.textContent = formatTime(audio.currentTime);

      if (!lrcLoaded) {
        if (audioLoaded && !audio.paused) {
          albumArtDiv.classList.add("show");
          albumArtDiv.classList.add("playing");
          lyricsDiv.classList.remove("show");
        } else if (audioLoaded && audio.paused) {
          albumArtDiv.classList.remove("playing");
        } else if (!audioLoaded) {
            albumArtDiv.classList.remove("show");
        }
        return;
      } else {
        lyricsDiv.classList.add("show");
        albumArtDiv.classList.remove("show");
        albumArtDiv.classList.remove("playing");
      }

      const currentTime = audio.currentTime;
      let i = 0;
      while (i < lyrics.length - 1 && currentTime >= lyrics[i + 1].time - 0.1) {
        i++;
      }

      if (i !== currentLine) {
        const divs = lyricsDiv.querySelectorAll("div");
        if (currentLine !== -1 && divs[currentLine]) {
          divs[currentLine].classList.remove("highlight");
        }
        if (divs[i]) {
          divs[i].classList.add("highlight");
          currentLine = i;
          const offset = divs[i].offsetTop - lyricsDiv.clientHeight / 2 + divs[i].clientHeight / 2;
          lyricsDiv.scrollTo({
            top: offset,
            behavior: 'smooth'
          });
        }
      }
    });

    audio.addEventListener("ended", function () {
      const divs = lyricsDiv.querySelectorAll("div");
      if (currentLine !== -1 && divs[currentLine]) {
        divs[currentLine].classList.remove("highlight");
      }
      currentLine = -1;
      lyricsDiv.classList.remove("show");
      albumArtDiv.classList.remove("playing");


      if (activePlaylistName && currentPlaylistSongs.length > 0) {
        playNextSongInPlaylist();
      } else { 
        audioLoaded = false; 
        checkAndShowControls(); 
        if (!lrcLoaded) { 
            albumArtDiv.classList.remove("show");
        }
      }
    });

    function playAudio() {
      if (!audio.src && (!activePlaylistName || currentPlaylistSongs.length === 0 || currentSongIndex === -1) && !isCountingDown) {
        alert("Vui l√≤ng t·∫£i l√™n m·ªôt t·ªáp √¢m thanh ho·∫∑c ch·ªçn m·ªôt danh s√°ch ph√°t v√† m·ªôt b√†i h√°t ƒë·ªÉ ph√°t!");
        return;
      }

      if (isCountingDown) return;


      if (audio.paused || audio.currentTime === 0) {
          isCountingDown = true;
          let count = 3;

          countdownOverlay.classList.add("show");

          const startCountdown = (num) => {
              countdownNumber.textContent = num;
              countdownNumber.style.animation = 'none';
              void countdownNumber.offsetWidth;
              countdownNumber.style.animation = 'countdownPop 1s ease-out forwards';
          };

          startCountdown(count);
          audio.pause(); 

          const countdownInterval = setInterval(() => {
              count--;
              if (count > 0) {
                  startCountdown(count);
              } else if (count === 0) {
                  startCountdown("GO!");
              } else {
                  clearInterval(countdownInterval);
                  countdownOverlay.classList.remove("show");
                  isCountingDown = false;

                  actualPlay(); 
              }
          }, 1000);
      } else {
          actualPlay(); 
      }
    }


    function actualPlay() {
      if (audio.src) {
        if (lrcLoaded) {
          displayLyricsContent();
          lyricsDiv.classList.add("show");
          albumArtDiv.classList.remove("show");
          albumArtDiv.classList.remove("playing");
        } else {
          lyricsDiv.classList.remove("show");
          albumArtDiv.classList.add("show");
          albumArtDiv.classList.add("playing");
        }
        checkAndShowControls();

        if (audioContext && audioContext.state === 'suspended') {
          audioContext.resume().then(() => {
            audio.play();
          });
        } else {
          audio.play();
        }

        if (audio.currentTime === 0 && lyrics.length > 0 && lrcLoaded) {
            const divs = lyricsDiv.querySelectorAll("div");
            divs.forEach((div) => div.classList.remove("highlight"));
            currentLine = -1;
            lyricsDiv.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
      }
    }


    function pauseAudio() {
      audio.pause();
      albumArtDiv.classList.remove("playing");
    }

    function rewindAudio() {
      audio.currentTime = Math.max(0, audio.currentTime - 10);
    }

    function forwardAudio() {
      audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
    }

    function setPlaybackSpeed(speed) {
      audio.playbackRate = speed;
      speedButtons.forEach(button => {
        button.classList.remove('active');
      });
      const activeButton = Array.from(speedButtons).find(button => parseFloat(button.textContent) === speed);
      if (activeButton) {
        activeButton.classList.add('active');
      }
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes.toString().padStart(2, "0")}:${secs
        .toString()
        .padStart(2, "0")}`;
    }

    checkAndShowControls();

    audio.addEventListener("loadedmetadata", () => {
      seekBar.max = audio.duration;
      durationSpan.textContent = formatTime(audio.duration);
      checkAndShowControls();
    });

    seekBar.addEventListener("input", () => {
      seekBar.changing = true;
      currentTimeSpan.textContent = formatTime(seekBar.value);
    });

    seekBar.addEventListener("change", () => {
      audio.currentTime = seekBar.value;
      seekBar.changing = false;
    });

    function showConfirmModal(title, message, onConfirm) {
      confirmModalTitle.textContent = title;
      confirmModalMessage.textContent = message;
      confirmOkButton.onclick = () => {
        onConfirm();
        hideConfirmModal();
      };
      confirmCancelButton.onclick = hideConfirmModal;
      confirmModal.classList.add('show');
    }

    function hideConfirmModal() {
      confirmModal.classList.remove('show');
    }

    function savePlaylists() {
     
    }

    function renderPlaylists() {
      playlistsList.innerHTML = '';
      for (const name in playlists) {
        const playlistItem = document.createElement('div');
        playlistItem.classList.add('playlist-item');
        if (name === activePlaylistName) {
          playlistItem.classList.add('active');
        }
        playlistItem.dataset.name = name;
        playlistItem.innerHTML = `
          <span>${name} (${playlists[name].length} b√†i)</span>
          <button onclick="deletePlaylist('${name}', event)">‚úñ</button>
        `;
        playlistItem.addEventListener('click', () => activatePlaylist(name));
        playlistsList.appendChild(playlistItem);
      }
    }

    function showCreatePlaylistModal() {
      newPlaylistNameInput.value = '';
      createPlaylistModal.classList.add('show');
    }

    function hideCreatePlaylistModal() {
      createPlaylistModal.classList.remove('show');
    }

    function createNewPlaylist() {
      const name = newPlaylistNameInput.value.trim();
      if (name) {
        if (playlists[name]) {
          alert("Danh s√°ch ph√°t ƒë√£ t·ªìn t·∫°i. Vui l√≤ng ch·ªçn t√™n kh√°c.");
          return;
        }
        playlists[name] = [];
        savePlaylists();
        renderPlaylists();
        hideCreatePlaylistModal();
        activatePlaylist(name);
      } else {
        alert("T√™n danh s√°ch ph√°t kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!");
      }
    }

    function deletePlaylist(name, event) {
      event.stopPropagation();
      showConfirmModal(`X√≥a danh s√°ch ph√°t "${name}"?`, `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn danh s√°ch ph√°t "${name}" v√† t·∫•t c·∫£ b√†i h√°t b√™n trong kh√¥ng?`, () => {
        delete playlists[name];
        savePlaylists(); 
        renderPlaylists();
        if (activePlaylistName === name) {
          activePlaylistName = null;
          currentPlaylistSongs = [];
          currentSongIndex = -1;
          currentPlaylistDiv.classList.remove('show');
          updateCurrentPlaylistDisplay();
          audio.pause();
          audio.src = '';
          songTitleDiv.textContent = '';
          displaySongTitleOnDisc('');
          albumArtDiv.classList.remove("show");
          albumArtDiv.classList.remove("playing");
          lyricsDiv.classList.remove("show");
          checkAndShowControls();
        }
      });
    }

    function activatePlaylist(name) {
      if (activePlaylistName === name && currentPlaylistDiv.classList.contains('show')) {
        currentPlaylistDiv.classList.remove('show');
        return;
      }

      activePlaylistName = name;
      currentPlaylistSongs = [...playlists[name]];
      currentSongIndex = -1; 
      currentPlaylistTitle.textContent = `Danh s√°ch: ${name}`;
      currentPlaylistDiv.classList.add('show');
      savePlaylists(); 
      renderPlaylists();
      updateCurrentPlaylistDisplay(); 
      audio.pause();
      audio.src = ''; 
      audioLoaded = false; 
      songTitleDiv.textContent = '';
      displaySongTitleOnDisc('');
      albumArtDiv.classList.remove("show");
      albumArtDiv.classList.remove("playing");
      lyricsDiv.classList.remove("show");
      checkAndShowControls(); 
    
      if (currentPlaylistSongs.length > 0) {
         playSongFromPlaylist(0); 
      }
    }

    function addSongToPlaylist(songName, songUrl) {
      if (!activePlaylistName) {
        alert("Vui l√≤ng ch·ªçn ho·∫∑c t·∫°o m·ªôt danh s√°ch ph√°t tr∆∞·ªõc.");
        return;
      }
      const newSong = {
        name: songName,
        url: songUrl
      };
      if (!playlists[activePlaylistName].some(song => song.url === newSong.url)) {
        playlists[activePlaylistName].push(newSong);
        savePlaylists();
        currentPlaylistSongs = [...playlists[activePlaylistName]];
        updateCurrentPlaylistDisplay();
        renderPlaylists();
        if (currentPlaylistSongs.length === 1 && currentSongIndex === -1) {
            playSongFromPlaylist(0);
        }
      } else {
        alert("B√†i h√°t ƒë√£ c√≥ trong danh s√°ch ph√°t n√†y.");
      }
    }

    function removeSongFromPlaylist(playlistName, songIndex) {
      showConfirmModal(`X√≥a b√†i h√°t kh·ªèi danh s√°ch?`, `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i h√°t "${playlists[playlistName][songIndex].name}" kh·ªèi danh s√°ch ph√°t "${playlistName}" kh√¥ng?`, () => {
        if (playlistName === activePlaylistName) {
          const wasPlayingThisSong = (currentSongIndex === songIndex && audio.src === playlists[playlistName][songIndex].url);

          playlists[playlistName].splice(songIndex, 1);
          savePlaylists(); 
          currentPlaylistSongs = [...playlists[playlistName]];

          if (wasPlayingThisSong) {
            audio.pause();
            audio.src = '';
            songTitleDiv.textContent = '';
            displaySongTitleOnDisc('');
            albumArtDiv.classList.remove("show");
            albumArtDiv.classList.remove("playing");
            lyricsDiv.classList.remove("show");
            currentSongIndex = -1;
            checkAndShowControls();
            if (currentPlaylistSongs.length > 0) {
                playNextSongInPlaylist();
            }
          } else if (currentSongIndex > songIndex) {
            currentSongIndex--;
          }


          updateCurrentPlaylistDisplay();
          renderPlaylists();

          if (currentPlaylistSongs.length === 0 && activePlaylistName === playlistName) {
            currentPlaylistDiv.classList.remove('show');
          }
        }
      });
    }


    function playSongFromPlaylist(index) {
      if (!currentPlaylistSongs[index]) {
        if (activePlaylistName && currentPlaylistSongs.length === 0) {
          alert("Danh s√°ch ph√°t hi·ªán t·∫°i r·ªóng.");
        }
        audio.pause();
        albumArtDiv.classList.remove("playing");
        currentSongIndex = -1;
        updateCurrentPlaylistDisplay();
        checkAndShowControls();
        return;
      }

      audio.src = currentPlaylistSongs[index].url;
      audioLoaded = true;
      songTitleDiv.textContent = currentPlaylistSongs[index].name;
      displaySongTitleOnDisc(currentPlaylistSongs[index].name);
      currentSongIndex = index;
      lrcLoaded = false;
      lyricsDiv.classList.remove("show");
      setupVisualizer();
      playAudio(); 
      updateCurrentPlaylistDisplay();
    }

   

    function playNextSongInPlaylist() {
        if (currentPlaylistSongs.length === 0) {
            audio.pause();
            albumArtDiv.classList.remove("playing");
            currentSongIndex = -1;
            updateCurrentPlaylistDisplay();
            checkAndShowControls();
            return;
        }

        let nextIndex = currentSongIndex + 1;
        if (nextIndex >= currentPlaylistSongs.length) {
            audio.pause();
            albumArtDiv.classList.remove("playing");
            currentSongIndex = -1;
            updateCurrentPlaylistDisplay();
            checkAndShowControls();
            return;
        }

        playSongFromPlaylist(nextIndex);
    }



    function updateCurrentPlaylistDisplay() {
      playlistSongsUl.innerHTML = '';
      if (currentPlaylistSongs.length === 0) {
        playlistSongsUl.innerHTML = '<li>Ch∆∞a c√≥ b√†i h√°t n√†o trong danh s√°ch n√†y.</li>';
        return;
      }
      currentPlaylistSongs.forEach((song, index) => {
        const li = document.createElement('li');
        li.textContent = song.name;
        li.dataset.index = index;
        if (currentSongIndex !== -1 && currentPlaylistSongs[currentSongIndex] && song.url === currentPlaylistSongs[currentSongIndex].url) {
          li.classList.add('playing');
        }
        li.addEventListener('click', () => playSongFromPlaylist(index));

        const removeBtn = document.createElement('button');
        removeBtn.textContent = '‚úñ';
        removeBtn.classList.add('remove-song-btn');
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          removeSongFromPlaylist(activePlaylistName, index);
        });
        li.appendChild(removeBtn);
        playlistSongsUl.appendChild(li);
      });
    }

    renderPlaylists();
    currentPlaylistDiv.classList.remove('show');
    audio.pause();
    audio.src = '';
    songTitleDiv.textContent = '';
    displaySongTitleOnDisc('');
    albumArtDiv.classList.remove("show");
    albumArtDiv.classList.remove("playing");
    lyricsDiv.classList.remove("show");
    checkAndShowControls();
  </script>
</body>

</html>
